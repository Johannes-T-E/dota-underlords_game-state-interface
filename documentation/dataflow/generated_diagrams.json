{
  "overview": "flowchart TD\n\n    %% Entry and Reception\n    entry[Game Client]:::entry\n    http[HTTP POST /upload]:::entry\n    receive[Receive GSI Data<br/><small>Background Task</small>]:::entry\n\n    %% Processing\n    process[Process GSI Payload<br/><small>Raw JSON</small>]:::process\n    extract[Extract Player States<br/><small>Iterate blocks</small>]:::extract\n    validate[Validate & Check Sequence<br/><small>Skip duplicates</small>]:::validate\n\n    %% Branching\n    branch{Match Active?}:::decision\n\n    %% No Match Path\n    buffer[Buffer Raw Data<br/><small>Temporary storage</small>]:::storage\n    collect[Collect 8 Candidates]:::process\n    match_start[Start Match<br/><small>Create match_id</small>]:::decision\n    process_buf[Process Buffered Data]:::process\n\n    %% Active Match Path\n    transform[Transform Data<br/><small>Raw to Structured</small>]:::transform\n    store_mem[Store in Memory<br/><small>Current state</small>]:::storage\n    store_db[Queue for DB<br/><small>Raw GSI + timestamp</small>]:::storage\n\n    %% Database\n    db_worker[DB Writer Worker<br/><small>Background thread</small>]:::storage\n    database[(SQLite Database)]:::storage\n\n    %% Delivery\n    emit[Emit WebSocket<br/><small>Structured state</small>]:::delivery\n    frontend[Frontend UI]:::delivery\n\n    %% Main Flow\n    entry -->|GSI Config| http\n    http --> receive\n    receive --> process\n    process --> extract\n    extract --> validate\n    validate --> branch\n\n    %% No Match Branch\n    branch -->|No| buffer\n    buffer --> collect\n    collect -->|8 players| match_start\n    match_start --> process_buf\n    process_buf --> transform\n\n    %% Active Match Branch\n    branch -->|Yes| transform\n    transform --> store_mem\n    store_mem --> store_db\n    store_mem --> emit\n\n    %% Database Path\n    store_db --> db_worker\n    db_worker --> database\n\n    %% Frontend Delivery\n    emit --> frontend",
  "private_vs_public": "flowchart TD\n\n    %% Entry\n    entry[Receive GSI Data]:::entry\n    extract[Extract from Payload<br/><small>Iterate block to data</small>]:::extract\n    check{Has private_player_state<br/>or public_player_state?}:::decision\n\n    %% Private State Path\n    has_private{Has<br/>private_player_state?}:::decision\n    priv_seq[Check Sequence<br/><small>Skip if duplicate</small>]:::validate\n    priv_match{Match Active?}:::decision\n    priv_buffer[Buffer Private State<br/><small>Raw GSI + timestamp</small>]:::storage\n    priv_process[Transform Private State<br/><small>Extract shop, items, etc</small>]:::transform\n    priv_memory[Update In-Memory<br/><small>Structured dict</small>]:::storage\n    priv_queue[Queue for DB<br/><small>Raw GSI</small>]:::storage\n\n    %% Public State Path\n    has_public{Has<br/>public_player_state?}:::decision\n    pub_account[Get Account ID<br/><small>Normalize for bots</small>]:::extract\n    pub_seq[Check Sequence<br/><small>Skip if duplicate</small>]:::validate\n    pub_match{Match Active?}:::decision\n\n    %% No Match - Public\n    pub_valid[Validate New Player<br/><small>Check health, level, etc</small>]:::validate\n    pub_buffer[Buffer Public State<br/><small>Raw GSI + timestamp</small>]:::storage\n    pub_candidate[Add to Candidates]:::process\n    pub_count{8 Candidates?}:::decision\n    start_match[Start Match<br/><small>Generate match_id</small>]:::decision\n    process_buf[Process All Buffered Data<br/><small>Both private & public</small>]:::process\n\n    %% Active Match - Public\n    pub_abandon[Check Abandonment<br/><small>Health reset or slot change</small>]:::validate\n    pub_process[Transform Public State<br/><small>Extract health, gold, units, etc</small>]:::transform\n    pub_memory[Update In-Memory<br/><small>Structured dict</small>]:::storage\n    pub_queue[Queue for DB<br/><small>Raw GSI</small>]:::storage\n    check_end[Check Match End<br/><small>final_place > 0</small>]:::decision\n\n    %% Convergence\n    emit[Emit WebSocket Update<br/><small>If any updates</small>]:::delivery\n\n    %% Main Flow\n    entry --> extract\n    extract --> check\n    check -->|Skip| extract\n    check -->|Continue| has_private\n\n    %% Private Flow\n    has_private -->|Yes| priv_seq\n    priv_seq -->|New| priv_match\n    priv_seq -->|Duplicate| has_public\n    priv_match -->|No| priv_buffer\n    priv_match -->|Yes| priv_process\n    priv_buffer --> has_public\n    priv_process --> priv_memory\n    priv_memory --> priv_queue\n    priv_queue --> has_public\n\n    %% Public Flow\n    has_private -->|No| has_public\n    has_public -->|Yes| pub_account\n    pub_account --> pub_seq\n    pub_seq -->|New| pub_match\n    pub_seq -->|Duplicate| emit\n\n    %% No Match - Public\n    pub_match -->|No| pub_valid\n    pub_valid -->|Valid| pub_buffer\n    pub_valid -->|Invalid| emit\n    pub_buffer --> pub_candidate\n    pub_candidate --> pub_count\n    pub_count -->|< 8| emit\n    pub_count -->|= 8| start_match\n    start_match --> process_buf\n    process_buf --> emit\n\n    %% Active Match - Public\n    pub_match -->|Yes| pub_abandon\n    pub_abandon -->|Abandoned| emit\n    pub_abandon -->|Continue| pub_process\n    pub_process --> pub_memory\n    pub_memory --> pub_queue\n    pub_queue --> check_end\n    check_end -->|Ended| emit\n    check_end -->|Continue| emit\n\n    %% End\n    has_public -->|No| emit",
  "database": "flowchart LR\n\n    %% Queue Operations\n    process[Process GSI Data]:::process\n    queue[DB Write Queue<br/><small>Thread-safe queue</small>]:::storage\n    worker[DB Writer Worker<br/><small>Background thread</small>]:::storage\n\n    %% Queue Items\n    insert[Insert Snapshot<br/><small>match_id, player_id, GSI, timestamp</small>]:::storage\n    update[Update Final Place<br/><small>match_id, player_id, place</small>]:::storage\n    end_match[End Match<br/><small>match_id, timestamp</small>]:::storage\n    delete[Delete Match<br/><small>match_id</small>]:::storage\n\n    %% Database Tables\n    db_matches[(matches table)]:::storage\n    db_players[(match_players table)]:::storage\n    db_public[(public_player_snapshots)]:::storage\n    db_private[(private_player_snapshots)]:::storage\n\n    %% Flow\n    process -->|queue.put| queue\n    queue -->|queue.get| worker\n    worker --> insert\n    worker --> update\n    worker --> end_match\n    worker --> delete\n\n    insert -->|Private| db_private\n    insert -->|Public| db_public\n    update --> db_players\n    end_match --> db_matches\n    delete --> db_matches\n    delete --> db_players\n    delete --> db_public\n    delete --> db_private",
  "websocket": "flowchart LR\n\n    %% Backend Processing\n    process[Process GSI Data]:::process\n    memory[In-Memory State<br/><small>Latest structured state</small>]:::storage\n    emit_check{Any Updates?}:::decision\n    emit[Emit Realtime Update]:::delivery\n\n    %% WebSocket\n    socketio[Socket.IO Server]:::delivery\n    clients[Connected Clients]:::delivery\n\n    %% Frontend\n    frontend[Frontend App]:::delivery\n    ui[UI Update]:::delivery\n\n    %% Flow\n    process --> memory\n    memory --> emit_check\n    emit_check -->|Yes| emit\n    emit_check -->|No| process\n    emit --> socketio\n    socketio --> clients\n    clients --> frontend\n    frontend --> ui"
}